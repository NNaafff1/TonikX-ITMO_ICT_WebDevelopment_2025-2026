# Задание 3 - HTTP Сервер

## Описание задания

Реализовать простой HTTP сервер, который отдает статическую HTML страницу. Сервер должен формировать корректный HTTP ответ с необходимыми заголовками и содержимым HTML файла.

## Теоретические основы

### HTTP Protocol (HyperText Transfer Protocol)

**HTTP** - протокол прикладного уровня для передачи гипертекстовых документов:
- Работает поверх TCP (обычно порт 80 или 8080)
- Использует модель запрос-ответ
- Без сохранения состояния (stateless)
- Текстовый протокол

### Структура HTTP ответа

```
HTTP/1.1 200 OK                          ← Строка статуса
Content-Type: text/html; charset=utf-8   ← Заголовки
Content-Length: 123                      
                                         ← Пустая строка
<!DOCTYPE html>                          ← Тело ответа
<html>...</html>
```

**Компоненты:**
1. **Строка статуса** - версия HTTP, код состояния, описание
2. **Заголовки** - метаданные о ответе
3. **Пустая строка** - разделитель (`\r\n\r\n`)
4. **Тело** - содержимое страницы

### HTTP Status Codes

| Код | Описание |
|-----|----------|
| 200 | OK - успешный запрос |
| 404 | Not Found - ресурс не найден |
| 500 | Internal Server Error |

## Структура проекта

```
task3/
├── server.py      # HTTP сервер
└── index.html     # Статическая HTML страница
```

## Реализация

### HTML страница (index.html)

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>NEWAFF Task 3</title>
</head>
<body>
  <h1>NEWAFF  welcome  </h1>
</body>
</html>
```

**Особенности:**
- Простая HTML5 структура
- UTF-8 кодировка
- Приветственное сообщение

### Серверная часть (server.py)

```python
import socket

HOST = "127.0.0.1"
PORT = 8001

with open("index.html", "rb") as f:
    html = f.read()

response = b"HTTP/1.1 200 OK\r\n" + \
           b"Content-Type: text/html; charset=utf-8\r\n" + \
           b"Content-Length: " + str(len(html)).encode() + b"\r\n\r\n" + html

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind((HOST, PORT))
    s.listen(5)
    print(f"Static server on http://{HOST}:{PORT}")
    while True:
        conn, addr = s.accept()
        with conn:
            conn.sendall(response)
```

**Основные компоненты:**

1. **Чтение HTML файла**
   - Открытие файла в бинарном режиме (`rb`)
   - Чтение всего содержимого в память
   
2. **Формирование HTTP ответа**
   - Строка статуса: `HTTP/1.1 200 OK`
   - Заголовок Content-Type указывает MIME-тип
   - Content-Length указывает размер тела
   - `\r\n\r\n` - разделитель заголовков и тела
   
3. **TCP сервер**
   - Использование SOCK_STREAM для TCP
   - Циклическая обработка подключений
   - Отправка одинакового ответа всем клиентам
   
4. **Упрощенная логика**
   - Сервер не читает запрос от клиента
   - Всегда отдает один и тот же ответ
   - Подходит для демонстрации основ HTTP

## Запуск приложения

### Шаг 1: Запуск сервера

```bash
cd task3
python server.py
```

Ожидаемый вывод:
```
Static server on http://127.0.0.1:8001
```

### Шаг 2: Открытие в браузере

Откройте браузер и перейдите по адресу:
```
http://127.0.0.1:8001
```

Или используйте curl:
```bash
curl http://127.0.0.1:8001
```

### Ожидаемый результат

В браузере отобразится страница с заголовком "NEWAFF welcome".

При использовании curl:
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>NEWAFF Task 3</title>
</head>
<body>
  <h1>NEWAFF  welcome  </h1>
</body>
</html>
```

## Диаграмма работы

```
Браузер                         HTTP Сервер
   |                                |
   |------ GET / HTTP/1.1 --------->|
   |                                |
   |                           [read index.html]
   |                           [form HTTP response]
   |                                |
   |<----- HTTP/1.1 200 OK ---------|
   |       Content-Type: text/html  |
   |       Content-Length: 123      |
   |                                |
   |       <!DOCTYPE html>...       |
   |                                |
   [render HTML]                    |
```

## Особенности реализации

!!! info "Бинарный режим"
    Файл читается в бинарном режиме (`rb`) для корректной работы с любым содержимым

!!! warning "Упрощенная реализация"
    Сервер не парсит HTTP запрос и всегда отдает один и тот же ответ

!!! note "Одностраничность"
    Сервер обслуживает только одну статическую страницу

## HTTP заголовки

### Content-Type
Указывает тип содержимого:
- `text/html` - HTML документ
- `charset=utf-8` - кодировка UTF-8

### Content-Length
Размер тела ответа в байтах. Важен для:
- Корректного определения конца сообщения
- Keep-alive соединений
- Прогресс-баров загрузки

## Сравнение с полноценным HTTP сервером

| Функция | Наша реализация | Apache/Nginx |
|---------|-----------------|--------------|
| Парсинг запроса | ❌ Нет | ✅ Да |
| Множество страниц | ❌ Нет | ✅ Да |
| Статические файлы | ⚠️ Одна страница | ✅ Да |
| HTTPS | ❌ Нет | ✅ Да |
| Кеширование | ❌ Нет | ✅ Да |
| Виртуальные хосты | ❌ Нет | ✅ Да |

## Возможные улучшения

1. **Парсинг HTTP запроса**
   ```python
   request = conn.recv(4096).decode()
   method, path, version = request.split('\n')[0].split()
   ```

2. **Обслуживание нескольких файлов**
   - Маршрутизация на основе URL
   - Динамическая загрузка файлов
   
3. **MIME типы**
   - Определение типа по расширению файла
   - Поддержка CSS, JavaScript, изображений
   
4. **Обработка ошибок**
   - 404 для несуществующих страниц
   - 500 для серверных ошибок
   
5. **Логирование**
   - Запись всех запросов
   - Формат Common Log Format

## Пример улучшенного ответа

```python
# С дополнительными заголовками
response = b"HTTP/1.1 200 OK\r\n" + \
           b"Server: MyHTTPServer/1.0\r\n" + \
           b"Date: " + datetime.now().strftime("%a, %d %b %Y %H:%M:%S GMT").encode() + b"\r\n" + \
           b"Content-Type: text/html; charset=utf-8\r\n" + \
           b"Content-Length: " + str(len(html)).encode() + b"\r\n" + \
           b"Connection: close\r\n\r\n" + \
           html
```

## Тестирование с curl

Просмотр заголовков:
```bash
curl -I http://127.0.0.1:8001
```

Полный ответ:
```bash
curl -v http://127.0.0.1:8001
```

## Выводы

В данном задании была реализована базовая версия HTTP сервера. Продемонстрированы:
- Основы HTTP протокола
- Формирование HTTP ответа с заголовками
- Отдача статического HTML содержимого
- Работа с файловой системой
- Использование TCP сокетов для HTTP

Эта реализация показывает фундаментальные принципы работы веб-серверов и является основой для понимания более сложных HTTP серверов в задании 5.
